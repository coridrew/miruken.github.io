---
layout: apidoc
title:  "MirukenJS"
date:   2015-06-01 00:00:00
categories: apidocs
yuiGridsUrl: http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css
yuiSeedUrl: http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js
projectAssets: ../assets
---
<div id="hd" class="yui3-g header row">
    <div class="yui3-u-1-4 version medium-12 columns">
        <em>API Docs for: 0.1.0</em>
    </div>
</div>
<div id="bd" class="yui3-g row">
    <div class="yui3-u-1-4 medium-4 columns">
        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list" class="panel">
                <h2 class="off-left">APIs</h2>
                <div id="api-tabview" class="tabview">
                    <ul class="tabs">
                        <li><a href="#api-classes">Classes</a></li>
                        <li><a href="#api-modules">Modules</a></li>
                    </ul>
            
                    <div id="api-tabview-filter">
                        <input type="search" id="api-filter" placeholder="Type to filter APIs">
                    </div>
            
                    <div id="api-tabview-panel">
                        <ul id="api-classes" class="apis classes no-bullet">
                            <li><a class="subheader" href="../classes/miruken.$.html">miruken.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.$inferProperties.html">miruken.$inferProperties</a></li>
                            <li><a class="subheader" href="../classes/miruken.$inhertStatic.html">miruken.$inhertStatic</a></li>
                            <li><a class="subheader" href="../classes/miruken.$properties.html">miruken.$properties</a></li>
                            <li><a class="subheader" href="../classes/miruken.$proxyProtocol.html">miruken.$proxyProtocol</a></li>
                            <li><a class="subheader" href="../classes/miruken.ArrayManager.html">miruken.ArrayManager</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.$.html">miruken.callback.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.$callbacks.html">miruken.callback.$callbacks</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CallbackHandler.html">miruken.callback.CallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CallbackHandlerx.html">miruken.callback.CallbackHandlerx</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CascadeCallbackHandler.html">miruken.callback.CascadeCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CompositeCallbackHandler.html">miruken.callback.CompositeCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Composition.html">miruken.callback.Composition</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CompositionScope.html">miruken.callback.CompositionScope</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Deferred.html">miruken.callback.Deferred</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.HandleMethod.html">miruken.callback.HandleMethod</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationDelegate.html">miruken.callback.InvocationDelegate</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationOptions.html">miruken.callback.InvocationOptions</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationOptionsHandler.html">miruken.callback.InvocationOptionsHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationSemantics.html">miruken.callback.InvocationSemantics</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Lookup.html">miruken.callback.Lookup</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.RejectedError.html">miruken.callback.RejectedError</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Resolution.html">miruken.callback.Resolution</a></li>
                            <li><a class="subheader" href="../classes/miruken.ClassMeta.html">miruken.ClassMeta</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.$contextual.html">miruken.context.$contextual</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.Context.html">miruken.context.Context</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextObserver.html">miruken.context.ContextObserver</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextState.html">miruken.context.ContextState</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.Contextual.html">miruken.context.Contextual</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextualHelper.html">miruken.context.ContextualHelper</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextualMixin.html">miruken.context.ContextualMixin</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.Function.html">miruken.context.Function</a></li>
                            <li><a class="subheader" href="../classes/miruken.Delegate.html">miruken.Delegate</a></li>
                            <li><a class="subheader" href="../classes/miruken.Disposing.html">miruken.Disposing</a></li>
                            <li><a class="subheader" href="../classes/miruken.DisposingMixin.html">miruken.DisposingMixin</a></li>
                            <li><a class="subheader" href="../classes/miruken.Enum.html">miruken.Enum</a></li>
                            <li><a class="subheader" href="../classes/miruken.error.ErrorCallbackHandler.html">miruken.error.ErrorCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.error.Errors.html">miruken.error.Errors</a></li>
                            <li><a class="subheader" href="../classes/miruken.Facet.html">miruken.Facet</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.Traversal.html">miruken.graph.Traversal</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.Traversing.html">miruken.graph.Traversing</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.TraversingAxis.html">miruken.graph.TraversingAxis</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.TraversingMixin.html">miruken.graph.TraversingMixin</a></li>
                            <li><a class="subheader" href="../classes/miruken.IndexedList.html">miruken.IndexedList</a></li>
                            <li><a class="subheader" href="../classes/miruken.InstanceMeta.html">miruken.InstanceMeta</a></li>
                            <li><a class="subheader" href="../classes/miruken.Interceptor.html">miruken.Interceptor</a></li>
                            <li><a class="subheader" href="../classes/miruken.InterceptorSelector.html">miruken.InterceptorSelector</a></li>
                            <li><a class="subheader" href="../classes/miruken.Invoking.html">miruken.Invoking</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.$.html">miruken.ioc.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.$container.html">miruken.ioc.$container</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.BasedOnBuilder.html">miruken.ioc.BasedOnBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentBuilder.html">miruken.ioc.ComponentBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentModel.html">miruken.ioc.ComponentModel</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentModelError.html">miruken.ioc.ComponentModelError</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentPolicy.html">miruken.ioc.ComponentPolicy</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Container.html">miruken.ioc.Container</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ContextualLifestyle.html">miruken.ioc.ContextualLifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyInspector.html">miruken.ioc.DependencyInspector</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyManager.html">miruken.ioc.DependencyManager</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyModel.html">miruken.ioc.DependencyModel</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyModifiers.html">miruken.ioc.DependencyModifiers</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyResolution.html">miruken.ioc.DependencyResolution</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyResolutionError.html">miruken.ioc.DependencyResolutionError</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.FromBuilder.html">miruken.ioc.FromBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.FromPackageBuilder.html">miruken.ioc.FromPackageBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Installer.html">miruken.ioc.Installer</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.InterceptorBuilder.html">miruken.ioc.InterceptorBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.IoContainer.html">miruken.ioc.IoContainer</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.KeyBuilder.html">miruken.ioc.KeyBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Lifestyle.html">miruken.ioc.Lifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Registration.html">miruken.ioc.Registration</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.SingletonLifestyle.html">miruken.ioc.SingletonLifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.TransientLifestyle.html">miruken.ioc.TransientLifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.MetaBase.html">miruken.MetaBase</a></li>
                            <li><a class="subheader" href="../classes/miruken.MetaMacro.html">miruken.MetaMacro</a></li>
                            <li><a class="subheader" href="../classes/miruken.MetaStep.html">miruken.MetaStep</a></li>
                            <li><a class="subheader" href="../classes/miruken.Miruken.html">miruken.Miruken</a></li>
                            <li><a class="subheader" href="../classes/miruken.Modifier.html">miruken.Modifier</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.Controller.html">miruken.mvc.Controller</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.MasterDetail.html">miruken.mvc.MasterDetail</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.MasterDetailAware.html">miruken.mvc.MasterDetailAware</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.Model.html">miruken.mvc.Model</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.ViewRegion.html">miruken.mvc.ViewRegion</a></li>
                            <li><a class="subheader" href="../classes/miruken.ng.Directive.html">miruken.ng.Directive</a></li>
                            <li><a class="subheader" href="../classes/miruken.ng.Runner.html">miruken.ng.Runner</a></li>
                            <li><a class="subheader" href="../classes/miruken.ng.UseModelValidation.html">miruken.ng.UseModelValidation</a></li>
                            <li><a class="subheader" href="../classes/miruken.ObjectDelegate.html">miruken.ObjectDelegate</a></li>
                            <li><a class="subheader" href="../classes/miruken.Parenting.html">miruken.Parenting</a></li>
                            <li><a class="subheader" href="../classes/miruken.Protocol.html">miruken.Protocol</a></li>
                            <li><a class="subheader" href="../classes/miruken.ProxyBuilder.html">miruken.ProxyBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.Starting.html">miruken.Starting</a></li>
                            <li><a class="subheader" href="../classes/miruken.Startup.html">miruken.Startup</a></li>
                            <li><a class="subheader" href="../classes/miruken.StrictProtocol.html">miruken.StrictProtocol</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.$.html">miruken.validate.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.$registerValidators.html">miruken.validate.$registerValidators</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.$validateThat.html">miruken.validate.$validateThat</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidateJsCallbackHandler.html">miruken.validate.ValidateJsCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.Validating.html">miruken.validate.Validating</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.Validation.html">miruken.validate.Validation</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidationCallbackHandler.html">miruken.validate.ValidationCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidationRegistry.html">miruken.validate.ValidationRegistry</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidationResult.html">miruken.validate.ValidationResult</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.Validator.html">miruken.validate.Validator</a></li>
                            <li><a class="subheader" href="../classes/miruken.Variance.html">miruken.Variance</a></li>
                        </ul>
            
                        <ul id="api-modules" class="apis modules">
                            <li><a href="../modules/callback.html">callback</a></li>
                            <li><a href="../modules/context.html">context</a></li>
                            <li><a href="../modules/error.html">error</a></li>
                            <li><a href="../modules/graph.html">graph</a></li>
                            <li><a href="../modules/ioc.html">ioc</a></li>
                            <li><a href="../modules/miruken.html">miruken</a></li>
                            <li><a href="../modules/mvc.html">mvc</a></li>
                            <li><a href="../modules/ng.html">ng</a></li>
                            <li><a href="../modules/validate.html">validate</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="yui3-u-3-4 medium-8 columns">
            <ul id="api-options">
                Show:
                <li class="ck-button">
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" name="api-show-inherited" checked>
                        <span>Inherited</span>
                    </label>
                </li>
                <li class="ck-button">
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected" name="api-show-protected">
                        <span>Protected</span>
                    </label>
                </li>
                <li class="ck-button">
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private" name="api-show-private">
                        <span>Private</span>
                    </label>
                </li>
                <li class="ck-button">
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated" name="api-show-deprecated">
                        <span>Deprecated</span>
                    </label>
                </li>
            </ul>
        
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <h1 class="file-heading">File: lib/context.js</h1>
                    
                    <div class="file">
                        <pre class="code prettyprint linenums">
                    var miruken = require(&#x27;./miruken.js&#x27;);
                                  require(&#x27;./graph.js&#x27;);
                                  require(&#x27;./callback.js&#x27;);
                    
                    new function () { // closure
                    
                        /**
                         * Package providing contextual support.&lt;br /&gt;
                         * Requires the {{#crossLinkModule &quot;miruken&quot;}}{{/crossLinkModule}},
                         * {{#crossLinkModule &quot;graph&quot;}}{{/crossLinkModule}} and 
                         * {{#crossLinkModule &quot;callback&quot;}}{{/crossLinkModule}} modules.
                         * @module miruken
                         * @submodule context
                         * @namespace miruken.context
                         */
                        var context = new base2.Package(this, {
                            name:    &quot;context&quot;,
                            version: miruken.version,
                            parent:  miruken,
                            imports: &quot;miruken,miruken.graph,miruken.callback&quot;,
                            exports: &quot;ContextState,ContextObserver,Context,Contextual,ContextualMixin,ContextualHelper,$contextual&quot;
                        });
                    
                        eval(this.imports);
                    
                        /**
                         * Represents the state of a {{#crossLink &quot;miruken.context.Context&quot;}}{{/crossLink}}.
                         * @class ContextState
                         * @extends miruken.Enum
                         */
                        var ContextState = Enum({
                            /**
                             * Context is active.
                             * @property {number} Active
                             */
                            Active: 1,
                            /**
                             * Context is in the process of ending.
                             * @property {number} Ending
                             */        
                            Ending: 2,
                            /**
                             * Context has ended.
                             * @property {number} Ended
                             */                
                            Ended:  3 
                        });
                    
                        /**
                         * Protocol for observing the lifecycle of
                         * {{#crossLink &quot;miruken.context.Context&quot;}}{{/crossLink}}.
                         * @class ContextObserver
                         * @extends miruken.Protocol
                         */
                        var ContextObserver = Protocol.extend({
                            /**
                             * Called when a context is in the process of ending.
                             * @method contextEnding
                             * @param   {miruken.context.Context}  context
                             */
                            contextEnding: function (context) {},
                            /**
                             * Called when a context has ended.
                             * @method contextEnded
                             * @param   {miruken.context.Context}  context
                             */        
                            contextEnded: function (context) {},
                            /**
                             * Called when a child context is in the process of ending.
                             * @method childContextEnding
                             * @param   {miruken.context.Context}  childContext
                             */
                            childContextEnding: function (childContext) {},
                            /**
                             * Called when a child context has ended.
                             * @method childContextEnded
                             * @param   {miruken.context.Context}  childContext
                             */        
                            childContextEnded: function (context) {}
                        });
                    
                        /**
                         * A Context represents the scope at a give point in time.&lt;br/&gt;
                         * It has a beginning and an end and can handle callbacks as well as notify observers of lifecycle changes.&lt;br/&gt;
                         * In addition, it maintains parent-child relationships and thus can participate in a hierarchy.
                         * @class Context
                         * @constructor
                         * @param   {miruken.context.Context}  [parent]  -  parent context
                         * @extends miruken.callback.CompositeCallbackHandler
                         * @uses miruken.Parenting
                         * @uses miruken.graph.Traversing
                         * @uses miruken.graph.TraversingMixin
                         * @uses miruken.Disposing
                         */    
                        var Context = CompositeCallbackHandler.extend(
                            Parenting, Traversing, Disposing, TraversingMixin,
                            $inferProperties, {
                            constructor: function (parent) {
                                this.base();
                    
                                var _state              = ContextState.Active,
                                    _parent             = parent,
                                    _children           = new Array2,
                                    _baseHandleCallback = this.handleCallback,
                                    _observers;
                    
                                this.extend({
                                    /**
                                     * Gets the context state.
                                     * @property {miruken.context.ContextState} state
                                     */
                                    getState: function () {
                                        return _state; 
                                    },
                                    /**
                                     * Gets the parent context.
                                     * @property {miruken.context.Context} parent
                                     */                
                                    getParent: function () {
                                        return _parent; 
                                    },
                                    /**
                                     * Gets the context children.
                                     * @property {Array} children
                                     */                                
                                    getChildren: function () {
                                        return _children.copy(); 
                                    },
                                    /**
                                     * Determines if the context has children.
                                     * @method hasChildren
                                     * @returns {boolean} true if context has children, false otherwise.
                                     */                                                
                                    hasChildren: function () {
                                        return _children.length &gt; 0; 
                                    },
                                    /**
                                     * Gets the root context.
                                     * @property {miruken.context.Context} root
                                     */                                
                                    getRoot: function () {
                                        var root = this;    
                                        while (root &amp;&amp; root.getParent()) {
                                            root = root.getParent();
                                        }
                                        return root;
                                    },
                                    newChild: function () {
                                        _ensureActive();
                                        var childContext = new ($classOf(this))(this).extend({
                                            end: function () {
                                                if (_observers) {
                                                    _observers.invoke(&#x27;childContextEnding&#x27;, childContext);
                                                }
                                                _children.remove(childContext);
                                                this.base();
                                                if (_observers) {
                                                    _observers.invoke(&#x27;childContextEnded&#x27;, childContext);
                                                }
                                            }
                                        });
                                        _children.push(childContext);
                                        return childContext;
                                    },
                                    /**
                                     * Stores the object in the context.
                                     * @method store
                                     * @param  {Object} object  -  object to store
                                     * @returns {miruken.context.Context} receiving context.
                                     * @chainable
                                     */                                                
                                    store: function (object) {
                                        if ($isSomething(object)) {
                                            $provide(this, object);
                                        }
                                        return this;
                                    },
                                    handleCallback: function (callback, greedy, composer) {
                                        var handled = this.base(callback, greedy, composer);
                                        if (handled &amp;&amp; !greedy) {
                                            return handled;
                                        }
                                        if (_parent) {
                                            handled = handled | _parent.handle(callback, greedy, composer);
                                        }
                                        return !!handled;
                                    },
                                    /**
                                     * Handles the callback using the traversing axis.
                                     * @method handleAxis
                                     * @param   {miruken.graph.TraversingAxis}     axis            -  any callback
                                     * @param   {Object}                           callback        -  any callback
                                     * @param   {boolean}                          [greedy=false]  -  true if handle greedily
                                     * @param   {miruken.callback.CallbackHandler} [composer]      -  composition handler
                                     * @returns {boolean} true if the callback was handled, false otherwise.
                                     */                
                                    handleAxis: function (axis, callback, greedy, composer) {
                                        if (callback === null || callback === undefined) {
                                            return false;
                                        }
                                        greedy   = !!greedy;
                                        composer = composer || this;
                                        if (axis == TraversingAxis.Self) {
                                            return _baseHandleCallback.call(this, callback, greedy, composer);
                                        }
                                        var handled = false;
                                        this.traverse(axis, function (node) {
                                            handled = handled
                                                    | node.handleAxis(TraversingAxis.Self, callback, greedy, composer);
                                            return handled &amp;&amp; !greedy;
                                        });
                                        return !!handled;
                                    },
                                    /**
                                     * Subscribes to the context notifications.
                                     * @method observe
                                     * @param   {miruken.context.ContextObserver}  observer  -  receives notifications
                                     * @returns {Function} unsubscribes from context notifications.
                                     */                                
                                    observe: function (observer) {
                                        _ensureActive();
                                        if (observer === null || observer === undefined) {
                                            return;
                                        }
                                        observer = ContextObserver(observer);
                                        (_observers || (_observers = new Array2)).push(observer);
                                        return function () { _observers.remove(observer); };
                                    },
                                    /**
                                     * Unwinds to the root context.
                                     * @method unwindToRootContext
                                     * @param   {miruken.context.ContextObserver}  observer  -  receives notifications
                                     * @returns {miruken.context.Context} receiving context.
                                     * @chainable
                                     */                                                
                                    unwindToRootContext: function () {
                                        var current = this;
                                        while (current) {
                                            if (current.getParent() == null) {
                                                current.unwind();
                                                return current;
                                            }
                                            current = current.getParent();
                                        }
                                        return this;
                                    },
                                    /**
                                     * Unwinds to the context by ending all children.
                                     * @method unwind
                                     * @returns {miruken.context.Context} receiving context.
                                     * @chainable
                                     */                                                
                                    unwind: function () {
                                        this.getChildren().invoke(&#x27;end&#x27;);
                                        return this;
                                    },
                                    /**
                                     * Ends the context.
                                     * @method end
                                     */                                                                
                                    end: function () { 
                                        if (_state == ContextState.Active) {
                                            _state = ContextState.Ending;
                                            if (_observers) {
                                                _observers.invoke(&#x27;contextEnding&#x27;, this);
                                            }
                                            this.unwind();
                                            _state = ContextState.Ended;
                                            if (_observers) {
                                                _observers.invoke(&#x27;contextEnded&#x27;, this);
                                            }
                                            _observers = null;
                                        }
                                    },
                                    dispose: function () { this.end(); }
                                });
                    
                                function _ensureActive() {
                                    if (_state != ContextState.Active) {
                                        throw new Error(&quot;The context has already ended.&quot;);
                                    }
                                }
                            }
                        });
                    
                        /**
                         * Protocol to provide the minimal functionality to support contextual based operations.&lt;br/&gt;
                         * This is an alternatve to the delegate model of communication, but with less coupling 
                         * and ceremony.
                         * @class Contextual
                         * @extends miruken.Protocol
                         */
                        var Contextual = Protocol.extend({
                            /**
                             * Gets the context associated with the receiver.
                             * @method getContext
                             * @returns {miruken.context.Context} associated context.
                             */
                            getContext: function () {},
                            /**
                             * Sets the context associated with the receiver.
                             * @method setContext
                             * @param  {miruken.contet.Context} context  -  associated context
                             */
                            setContext: function (context) {}
                        });
                    
                        /**
                         * Mixin for {{#crossLink &quot;miruken.context.Contextual&quot;}}{{/crossLink}} implementation.
                         * @class ContextualMixin
                         * @uses miruken.context.Contextual
                         * @extends Module
                         */
                        var ContextualMixin = Module.extend({
                            getContext: function (object) {
                                return object.__context;
                            },
                            setContext: function (object, context) {
                                if (object.__context === context) {
                                    return;
                                }
                                if (object.__context)
                                    object.__context.removeHandlers(object);
                                if (context) {
                                    object.__context = context;
                                    context.addHandlers(object);
                                } else {
                                    delete object.__context;
                                }
                            },
                            /**
                             * Determines if the receivers context is active.
                             * @method isActiveContext
                             * @returns {boolean} true if the receivers context is active, false otherwise.
                             */        
                            isActiveContext: function (object) {
                                return object.__context &amp;&amp; (object.__context.getState() === ContextState.Active);
                            },
                            /**
                             * Ends the receivers context.
                             * @method endContext
                             */                
                            endContext: function (object) {
                                if (object.__context) {
                                    object.__context.end();
                                }
                            }
                        });
                    
                        /**
                         * Metamacro to make classes contextual.&lt;br/&gt;
                         * See {{#crossLink &quot;miruken.context.ContextualMixin&quot;}}{{/crossLink}}
                         * &lt;pre&gt;
                         *    var Controller = Base.extend($contextual, {
                         *       action: function () {}
                         *    })
                         * &lt;/pre&gt;
                         * would give the Controller class contextual support.
                         * @class $contextual
                         * @constructor
                         * @extends miruken.MetaMacro
                         */    
                        var $contextual = MetaMacro.extend({
                            apply: function (step, metadata) {
                                if (step === MetaStep.Subclass) {
                                    var clazz = metadata.getClass();
                                    clazz.$meta.addProtocol(Contextual);
                                    clazz.implement(ContextualMixin);
                                }
                            }
                        });
                    
                        /**
                         * Mixin for {{#crossLink &quot;miruken.context.Contextual&quot;}}{{/crossLink}} helper support.
                         * @class ContextualHelper
                         * @extends Module
                         */    
                        var ContextualHelper = Module.extend({
                            /**
                             * Resolves the receivers context.
                             * @method resolveContext
                             * @returns {miruken.context.Context} receiver if a context or getContext of receiver. 
                             */                
                            resolveContext: function (contextual) {
                                if (!contextual) return null;
                                if (contextual instanceof Context) return contextual;
                                return $isFunction(contextual.getContext)
                                     ? contextual.getContext() : null;
                            },
                            /**
                             * Ensure the receiver is associated with a context.
                             * @method requireContext
                             * @throws {Error} an error if a context could not be resolved.
                             */                        
                            requireContext: function (contextual) {
                                var context = ContextualHelper.resolveContext(contextual);
                                if (!(context instanceof Context))
                                    throw new Error(&quot;The supplied object is not a Context or Contextual object.&quot;);
                                return context;
                            },
                            /**
                             * Clears and ends the receivers associated context.
                             * @method clearContext
                             */                                
                            clearContext: function (contextual) {
                                if (!contextual ||
                                    !$isFunction(contextual.getContext) || 
                                    !$isFunction(contextual.setContext)) {
                                    return;
                                }
                                var context = contextual.getContext();
                                if (context) {
                                    try {
                                        context.end();
                                    }
                                    finally {
                                        contextual.setContext(null);
                                    }
                                }
                            },
                            /**
                             * Attaches the context to the receiver.
                             * @method bindContext
                             * @param  {miruken.context.Context}  context  -  context
                             * @param  {boolean}                  replace  -  true if replace existing context
                             * @returns {miruken.context.Context} effective context.
                             * @throws {Error} an error if the context could be attached.
                             */                                        
                            bindContext: function (contextual, context, replace) {
                                if (!contextual ||
                                    (!replace &amp;&amp; $isFunction(contextual.getContext)
                                     &amp;&amp; contextual.getContext())) {
                                    return contextual;
                                }
                                if (contextual.setContext === undefined) {
                                    contextual = ContextualMixin(contextual);
                                } else if (!$isFunction(contextual.setContext)) {
                                    throw new Error(&quot;Unable to set the context on &quot; + contextual + &quot;.&quot;);
                                }
                                contextual.setContext(ContextualHelper.resolveContext(context));
                                return contextual;
                            },
                            /**
                             * Attaches a child context of the receiver to the contextual child.
                             * @method bindChildContext
                             * @param  {miruken.context.Context}  child  -  contextual child
                             * @param  {boolean}                  replace  -  true if replace existing context
                             * @returns {miruken.context.Context} effective child context.
                             * @throws {Error} an error if the child context could be attached.
                             */                                                
                            bindChildContext: function (contextual, child, replace) {
                                var childContext;
                                if (child) {
                                    if (!replace &amp;&amp; $isFunction(child.getContext)) {
                                        childContext = child.getContext();
                                        if (childContext &amp;&amp; childContext.getState() === ContextState.Active) {
                                            return childContext;
                                        }
                                    }
                                    var context  = ContextualHelper.requireContext(contextual);
                                    while (context &amp;&amp; context.getState() !== ContextState.Active) {
                                        context = context.getParent();
                                    }
                                    if (context) {
                                        childContext = context.newChild();
                                        ContextualHelper.bindContext(child, childContext, true);
                                    }
                                }
                                return childContext;
                            }
                        });
                        
                       /**
                         * Context traversal
                         */
                        var axisControl = {
                            /**
                             * Changes the default traversal axis.
                             * @method axis
                             * @param   {miruken.graph.TraversingAxis}  axis  -  axis
                             * @returns {miruken.context.Context} callback handler axis.
                             * @for miruken.context.Context
                             */
                            axis: function (axis) {
                                return this.decorate({
                                    handle: function (callback, greedy, composer) {
                                        return (callback instanceof Composition)
                                             ? base.handle(callback, greedy, composer)
                                             : this.handleAxis(axis, callback, greedy, composer);
                                    }
                                });
                            }},
                            applyAxis   = axisControl.axis,
                            axisChoices = Array2.combine(TraversingAxis.names, TraversingAxis.values);
                    
                        for (var name in axisChoices) {
                            var axis = axisChoices[name],
                                key  = &#x27;$&#x27; + name.charAt(0).toLowerCase() + name.slice(1);
                            axisControl[key] = Function2.partial(applyAxis, axis);
                        }
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/Self:property&quot;}}{{/crossLink}}.
                         * @method $self
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/Root:property&quot;}}{{/crossLink}}.
                         * @method $root
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/Child:property&quot;}}{{/crossLink}}.
                         * @method $child
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/Sibling:property&quot;}}{{/crossLink}}.
                         * @method $sibling
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/Ancestor:property&quot;}}{{/crossLink}}.
                         * @method $ancestor
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/Descendant:property&quot;}}{{/crossLink}}.
                         * @method $descendant
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/DescendantReverse:property&quot;}}{{/crossLink}}.
                         * @method $descendantReverse
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */        
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/ChildOrSelf:property&quot;}}{{/crossLink}}.
                         * @method $childOrSelf
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/SiblingOrSelf:property&quot;}}{{/crossLink}}.
                         * @method $siblingOrSelf
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/AncestorOrSelf:property&quot;}}{{/crossLink}}.
                         * @method $ancestorOrSelf
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */        
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/DescendantOrSelf:property&quot;}}{{/crossLink}}.
                         * @method $descendantOrSelf
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/DescendantOrSelfReverse:property&quot;}}{{/crossLink}}.
                         * @method $descendantOrSelfReverse
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        /**
                         * Sets the default traversal axis to
                         * {{#crossLink &quot;miruken.graph.TraversingAxis/AncestorSiblingOrSelf:property&quot;}}{{/crossLink}}.
                         * @method $ancestorSiblingOrSelf
                         * @returns {miruken.context.Context} default traversal axis.
                         * @for miruken.context.Context
                         */
                    
                        Context.implement(axisControl);
                    
                        /**
                         * Enhances Functions to create instances in a context.
                         * @method newInContext
                         * @for Function
                         */
                        if (Function.prototype.newInContext === undefined)
                            Function.prototype.newInContext = function () {
                                var args        = Array.prototype.slice.call(arguments),
                                    context     = args.shift(),
                                    constructor = this;
                                function Fake() { constructor.apply(this, args); }
                                Fake.prototype  = constructor.prototype;
                                var object      = new Fake;
                                ContextualHelper.bindContext(object, context);
                                return object;
                            };
                    
                        /**
                         * Enhances Functions to create instances in a child context.
                         * @method newInChildContext
                         * @for Function
                         */
                        if (Function.prototype.newInChildContext === undefined)
                            Function.prototype.newInChildContext = function () {
                                var args        = Array.prototype.slice.call(arguments),
                                    context     = args.shift(),
                                    constructor = this;
                                function Fake() { constructor.apply(this, args); }
                                Fake.prototype  = constructor.prototype;
                                var object      = new Fake;
                                ContextualHelper.bindChildContext(context, object);
                                return object;
                            };
                    
                        if (typeof module !== &#x27;undefined&#x27; &amp;&amp; module.exports) {
                            module.exports = exports = context;
                        }
                    
                        eval(this.exports);
                    
                    }
                    
                        </pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>