---
layout: apidoc
title:  "MirukenJS"
date:   2015-06-01 00:00:00
categories: apidocs
yuiGridsUrl: http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css
yuiSeedUrl: http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js
projectAssets: ../assets
---
<div id="hd" class="yui3-g header row">
    <div class="yui3-u-1-4 version medium-12 columns">
        <em>API Docs for: 0.1.0</em>
    </div>
</div>
<div id="bd" class="yui3-g row">
    <div class="yui3-u-1-4 medium-4 columns">
        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list" class="panel">
                <h2 class="off-left">APIs</h2>
                <div id="api-tabview" class="tabview">
                    <ul class="tabs">
                        <li><a href="#api-classes">Classes</a></li>
                        <li><a href="#api-modules">Modules</a></li>
                    </ul>
            
                    <div id="api-tabview-filter">
                        <input type="search" id="api-filter" placeholder="Type to filter APIs">
                    </div>
            
                    <div id="api-tabview-panel">
                        <ul id="api-classes" class="apis classes no-bullet">
                            <li><a class="subheader" href="../classes/miruken.$.html">miruken.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.$inferProperties.html">miruken.$inferProperties</a></li>
                            <li><a class="subheader" href="../classes/miruken.$inhertStatic.html">miruken.$inhertStatic</a></li>
                            <li><a class="subheader" href="../classes/miruken.$properties.html">miruken.$properties</a></li>
                            <li><a class="subheader" href="../classes/miruken.$proxyProtocol.html">miruken.$proxyProtocol</a></li>
                            <li><a class="subheader" href="../classes/miruken.ArrayManager.html">miruken.ArrayManager</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.$.html">miruken.callback.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.$callbacks.html">miruken.callback.$callbacks</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CallbackHandler.html">miruken.callback.CallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CallbackHandlerx.html">miruken.callback.CallbackHandlerx</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CascadeCallbackHandler.html">miruken.callback.CascadeCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CompositeCallbackHandler.html">miruken.callback.CompositeCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Composition.html">miruken.callback.Composition</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.CompositionScope.html">miruken.callback.CompositionScope</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Deferred.html">miruken.callback.Deferred</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.HandleMethod.html">miruken.callback.HandleMethod</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationDelegate.html">miruken.callback.InvocationDelegate</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationOptions.html">miruken.callback.InvocationOptions</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationOptionsHandler.html">miruken.callback.InvocationOptionsHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.InvocationSemantics.html">miruken.callback.InvocationSemantics</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Lookup.html">miruken.callback.Lookup</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.RejectedError.html">miruken.callback.RejectedError</a></li>
                            <li><a class="subheader" href="../classes/miruken.callback.Resolution.html">miruken.callback.Resolution</a></li>
                            <li><a class="subheader" href="../classes/miruken.ClassMeta.html">miruken.ClassMeta</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.$contextual.html">miruken.context.$contextual</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.Context.html">miruken.context.Context</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextObserver.html">miruken.context.ContextObserver</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextState.html">miruken.context.ContextState</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.Contextual.html">miruken.context.Contextual</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextualHelper.html">miruken.context.ContextualHelper</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.ContextualMixin.html">miruken.context.ContextualMixin</a></li>
                            <li><a class="subheader" href="../classes/miruken.context.Function.html">miruken.context.Function</a></li>
                            <li><a class="subheader" href="../classes/miruken.Delegate.html">miruken.Delegate</a></li>
                            <li><a class="subheader" href="../classes/miruken.Disposing.html">miruken.Disposing</a></li>
                            <li><a class="subheader" href="../classes/miruken.DisposingMixin.html">miruken.DisposingMixin</a></li>
                            <li><a class="subheader" href="../classes/miruken.Enum.html">miruken.Enum</a></li>
                            <li><a class="subheader" href="../classes/miruken.error.ErrorCallbackHandler.html">miruken.error.ErrorCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.error.Errors.html">miruken.error.Errors</a></li>
                            <li><a class="subheader" href="../classes/miruken.Facet.html">miruken.Facet</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.Traversal.html">miruken.graph.Traversal</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.Traversing.html">miruken.graph.Traversing</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.TraversingAxis.html">miruken.graph.TraversingAxis</a></li>
                            <li><a class="subheader" href="../classes/miruken.graph.TraversingMixin.html">miruken.graph.TraversingMixin</a></li>
                            <li><a class="subheader" href="../classes/miruken.IndexedList.html">miruken.IndexedList</a></li>
                            <li><a class="subheader" href="../classes/miruken.InstanceMeta.html">miruken.InstanceMeta</a></li>
                            <li><a class="subheader" href="../classes/miruken.Interceptor.html">miruken.Interceptor</a></li>
                            <li><a class="subheader" href="../classes/miruken.InterceptorSelector.html">miruken.InterceptorSelector</a></li>
                            <li><a class="subheader" href="../classes/miruken.Invoking.html">miruken.Invoking</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.$.html">miruken.ioc.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.$container.html">miruken.ioc.$container</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.BasedOnBuilder.html">miruken.ioc.BasedOnBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentBuilder.html">miruken.ioc.ComponentBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentModel.html">miruken.ioc.ComponentModel</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentModelError.html">miruken.ioc.ComponentModelError</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ComponentPolicy.html">miruken.ioc.ComponentPolicy</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Container.html">miruken.ioc.Container</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.ContextualLifestyle.html">miruken.ioc.ContextualLifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyInspector.html">miruken.ioc.DependencyInspector</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyManager.html">miruken.ioc.DependencyManager</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyModel.html">miruken.ioc.DependencyModel</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyModifiers.html">miruken.ioc.DependencyModifiers</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyResolution.html">miruken.ioc.DependencyResolution</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.DependencyResolutionError.html">miruken.ioc.DependencyResolutionError</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.FromBuilder.html">miruken.ioc.FromBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.FromPackageBuilder.html">miruken.ioc.FromPackageBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Installer.html">miruken.ioc.Installer</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.InterceptorBuilder.html">miruken.ioc.InterceptorBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.IoContainer.html">miruken.ioc.IoContainer</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.KeyBuilder.html">miruken.ioc.KeyBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Lifestyle.html">miruken.ioc.Lifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.Registration.html">miruken.ioc.Registration</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.SingletonLifestyle.html">miruken.ioc.SingletonLifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.ioc.TransientLifestyle.html">miruken.ioc.TransientLifestyle</a></li>
                            <li><a class="subheader" href="../classes/miruken.MetaBase.html">miruken.MetaBase</a></li>
                            <li><a class="subheader" href="../classes/miruken.MetaMacro.html">miruken.MetaMacro</a></li>
                            <li><a class="subheader" href="../classes/miruken.MetaStep.html">miruken.MetaStep</a></li>
                            <li><a class="subheader" href="../classes/miruken.Miruken.html">miruken.Miruken</a></li>
                            <li><a class="subheader" href="../classes/miruken.Modifier.html">miruken.Modifier</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.Controller.html">miruken.mvc.Controller</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.MasterDetail.html">miruken.mvc.MasterDetail</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.MasterDetailAware.html">miruken.mvc.MasterDetailAware</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.Model.html">miruken.mvc.Model</a></li>
                            <li><a class="subheader" href="../classes/miruken.mvc.ViewRegion.html">miruken.mvc.ViewRegion</a></li>
                            <li><a class="subheader" href="../classes/miruken.ng.Directive.html">miruken.ng.Directive</a></li>
                            <li><a class="subheader" href="../classes/miruken.ng.Runner.html">miruken.ng.Runner</a></li>
                            <li><a class="subheader" href="../classes/miruken.ng.UseModelValidation.html">miruken.ng.UseModelValidation</a></li>
                            <li><a class="subheader" href="../classes/miruken.ObjectDelegate.html">miruken.ObjectDelegate</a></li>
                            <li><a class="subheader" href="../classes/miruken.Parenting.html">miruken.Parenting</a></li>
                            <li><a class="subheader" href="../classes/miruken.Protocol.html">miruken.Protocol</a></li>
                            <li><a class="subheader" href="../classes/miruken.ProxyBuilder.html">miruken.ProxyBuilder</a></li>
                            <li><a class="subheader" href="../classes/miruken.Starting.html">miruken.Starting</a></li>
                            <li><a class="subheader" href="../classes/miruken.Startup.html">miruken.Startup</a></li>
                            <li><a class="subheader" href="../classes/miruken.StrictProtocol.html">miruken.StrictProtocol</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.$.html">miruken.validate.$</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.$registerValidators.html">miruken.validate.$registerValidators</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.$validateThat.html">miruken.validate.$validateThat</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidateJsCallbackHandler.html">miruken.validate.ValidateJsCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.Validating.html">miruken.validate.Validating</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.Validation.html">miruken.validate.Validation</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidationCallbackHandler.html">miruken.validate.ValidationCallbackHandler</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidationRegistry.html">miruken.validate.ValidationRegistry</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.ValidationResult.html">miruken.validate.ValidationResult</a></li>
                            <li><a class="subheader" href="../classes/miruken.validate.Validator.html">miruken.validate.Validator</a></li>
                            <li><a class="subheader" href="../classes/miruken.Variance.html">miruken.Variance</a></li>
                        </ul>
            
                        <ul id="api-modules" class="apis modules">
                            <li><a href="../modules/callback.html">callback</a></li>
                            <li><a href="../modules/context.html">context</a></li>
                            <li><a href="../modules/error.html">error</a></li>
                            <li><a href="../modules/graph.html">graph</a></li>
                            <li><a href="../modules/ioc.html">ioc</a></li>
                            <li><a href="../modules/miruken.html">miruken</a></li>
                            <li><a href="../modules/mvc.html">mvc</a></li>
                            <li><a href="../modules/ng.html">ng</a></li>
                            <li><a href="../modules/validate.html">validate</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="yui3-u-3-4 medium-8 columns">
            <ul id="api-options">
                Show:
                <li class="ck-button">
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" name="api-show-inherited" checked>
                        <span>Inherited</span>
                    </label>
                </li>
                <li class="ck-button">
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected" name="api-show-protected">
                        <span>Protected</span>
                    </label>
                </li>
                <li class="ck-button">
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private" name="api-show-private">
                        <span>Private</span>
                    </label>
                </li>
                <li class="ck-button">
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated" name="api-show-deprecated">
                        <span>Deprecated</span>
                    </label>
                </li>
            </ul>
        
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <h1 class="file-heading">File: lib/validate/validatejs.js</h1>
                    
                    <div class="file">
                        <pre class="code prettyprint linenums">
                    var miruken    = require(&#x27;../miruken.js&#x27;),
                        validate   = require(&#x27;./validate.js&#x27;),
                        validatejs = require(&quot;validate.js&quot;),
                        Promise    = require(&#x27;bluebird&#x27;);
                                     require(&#x27;../callback.js&#x27;);
                    
                    new function () { // closure
                    
                        /**
                         * @module miruken
                         * @submodule validate
                         * @namespace miruken.validate
                         * @class $
                         */    
                        var validate = new base2.Package(this, {
                            name:    &quot;validate&quot;,
                            version: miruken.version,
                            parent:  miruken,
                            imports: &quot;miruken,miruken.callback,miruken.validate&quot;,
                            exports: &quot;ValidationRegistry,ValidateJsCallbackHandler,$required,$nested&quot;
                        });
                    
                        eval(this.imports);
                    
                        validatejs.Promise = Promise;
                    
                        var DETAILED    = { format: &quot;detailed&quot; },
                            VALIDATABLE = { validate: undefined },
                            /**
                             * Shortcut to indicate required property.
                             * @property {Object} $required
                             * @readOnly
                             * @for miruken.validate.$ 
                             */
                            $required   = Object.freeze({ presence: true }),
                            /**
                             * Shortcut to indicate nested validation.
                             * @property {Object} $nested
                             * @readOnly
                             * @for miruken.validate.$ 
                             */
                            $nested     = Object.freeze({ nested: true });
                    
                        validatejs.validators.nested = Undefined;
                    
                        /**
                         * Metamacro to register custom validators with [validate.js](http://validatejs.org).
                         * &lt;pre&gt;
                         *    var CustomValidators = Base.extend($registerValidators, {
                         *        uniqueUserName: [Database, function (db, userName) {
                         *            if (db.hasUserName(userName)) {
                         *               return &quot;UserName &quot; + userName + &quot; is already taken&quot;;
                         *            }
                         *        }]
                         *    })
                         * &lt;/pre&gt;
                         * would register a uniqueUserName validator with a Database dependency.
                         * @class $registerValidators
                         * @extends miruken.MetaMacro
                         */    
                        var $registerValidators = MetaMacro.extend({
                            apply: function (step, metadata, target, definition) {
                                if (step === MetaStep.Subclass || step === MetaStep.Implement) {
                                    for (var name in definition) {
                                        var validator = definition[name];
                                        if (validator instanceof Array) {
                                            var dependencies = validator.slice(0);
                                            validator = dependencies.pop();
                                            if (!$isFunction(validator)) {
                                                continue;
                                            }
                                            if (dependencies.length &gt; 0) {
                                                validator = (function (nm, val, deps) {
                                                    return function () {
                                                        if (!$composer) {
                                                            throw new Error(&quot;Unable to invoke validator &#x27;&quot; + nm + &quot;&#x27;.&quot;);
                                                        }
                                                        var d = Array2.concat(deps, Array2.map(arguments, $use));
                                                        return Invoking($composer).invoke(val, d);
                                                    }
                                                })(name, validator, dependencies);
                                            }
                                        }
                                        if ($isFunction(validator)) {
                                            validatejs.validators[name] = validator;
                                        }
                                    }
                                }
                            },
                            /**
                             * Determines if the macro should be inherited
                             * @method shouldInherit
                             * @returns {boolean} true
                             */        
                            shouldInherit: True,
                            /**
                             * Determines if the macro should be applied on extension.
                             * @method isActive
                             * @returns {boolean} true
                             */        
                            isActive: True
                        });
                    
                        /**
                         * Base class to define custom validators using
                         * {{#crossLink &quot;miruken.validate.$registerValidators&quot;}}{{/crossLink}}.
                         * &lt;pre&gt;
                         *    var CustomValidators = ValidationRegistry.extend({
                         *        creditCardNumber: function (cardNumber, options, key, attributes) {
                         *           // do the check...
                         *        }
                         *    })
                         * &lt;/pre&gt;
                         * would register a creditCardNumber validator function.
                         * @class ValidationRegistry
                         * @constructor
                         * @extends Abstract
                         */        
                        var ValidationRegistry = Abstract.extend($registerValidators);
                    
                        /**
                         * CallbackHandler for performing validation using [validate.js](http://validatejs.org)
                         * &lt;p&gt;
                         * Classes participate in validation by declaring **validate** constraints on properties.
                         * &lt;/p&gt;
                         * &lt;pre&gt;
                         * var Address = Base.extend({
                         *     $properties: {
                         *         line:    { &lt;b&gt;validate&lt;/b&gt;: { presence: true } },
                         *         city:    { &lt;b&gt;validate&lt;/b&gt;: { presence: true } },
                         *         state:   { 
                         *             &lt;b&gt;validate&lt;/b&gt;: {
                         *                 presence: true,
                         *                 length: { is: 2 }
                         *             }
                         *         },
                         *         zipcode: { 
                         *             &lt;b&gt;validate&lt;/b&gt;: {
                         *                 presence: true,
                         *                 length: { is: 5 }
                         *         }
                         *     }
                         * })
                         * &lt;/pre&gt;
                         * @class ValidateJsCallbackHandler
                         * @extends miruken.callback.CallbackHandler
                         */            
                        var ValidateJsCallbackHandler = CallbackHandler.extend({
                            $validate: [
                                null,  function (validation, composer) {
                                    var target      = validation.getObject(),
                                        nested      = {},
                                        constraints = _buildConstraints(target, nested);
                                    if (constraints) {
                                        var scope     = validation.getScope(),
                                            results   = validation.getResults(),
                                            validator = Validator(composer); 
                                        if (validation.isAsync()) {
                                            return validatejs.async(target, constraints, DETAILED)
                                                .then(function (valid) {
                                                     return _validateNestedAsync(validator, scope, results, nested);
                                                }, function (errors) {
                                                    if (errors instanceof Error) {
                                                        return Promise.reject(errors);
                                                    }
                                                    return _validateNestedAsync(validator, scope, results, nested).then(function () {
                                                        _mapResults(results, errors);
                                                    });
                                                });
                                        } else {
                                            var errors = validatejs(target, constraints, DETAILED);
                                            for (var key in nested) {
                                                var child = nested[key];
                                                if (child instanceof Array) {
                                                    for (var i = 0; i &lt; child.length; ++i) {
                                                        validator.validate(child[i], scope, results.addKey(key + &#x27;.&#x27; + i));
                                                    }
                                                } else {
                                                    validator.validate(child, scope, results.addKey(key));
                                                }
                                            }
                                            _mapResults(results, errors);
                                        }
                                    }
                                }
                            ]
                        });
                    
                        function _validateNestedAsync(validator, scope, results, nested) {
                            var pending = [];
                            for (var key in nested) {
                                var child = nested[key], childResults;
                                if (child instanceof Array) {
                                    for (var i = 0; i &lt; child.length; ++i) {
                                        childResults = results.addKey(key + &#x27;.&#x27; + i);
                                        childResults = validator.validateAsync(child[i], scope, childResults);
                                        pending.push(childResults);
                                    }
                                } else {
                                    childResults = results.addKey(key);
                                    childResults = validator.validateAsync(child, scope, childResults);
                                    pending.push(childResults);
                                }
                            }
                            return Promise.all(pending);
                        }
                    
                        function _mapResults(results, errors) {
                            if (errors) {
                                Array2.forEach(errors, function (error) {
                                    results.addKey(error.attribute).addError(error.validator, {
                                        message: error.error,
                                        value:   error.value 
                                    });
                                });
                            }
                        }
                    
                        function _buildConstraints(target, nested) {
                            var meta        = target.$meta,
                                descriptors = meta &amp;&amp; meta.getDescriptor(VALIDATABLE),
                                constraints;
                            if (descriptors) {
                                for (var key in descriptors) {
                                    var descriptor = descriptors[key],
                                        validate   = descriptor.validate;
                                    (constraints || (constraints = {}))[key] = validate;
                                    for (name in validate) {
                                        if (name === &#x27;nested&#x27;) {
                                            var child = target[key];
                                            if (child) {
                                                nested[key] = child;
                                            }
                                        } else if (!(name in validatejs.validators)) {
                                            validatejs.validators[name] = function () {
                                                var validator = $composer &amp;&amp; $composer.resolve(name);
                                                if (!validator) {
                                                    throw new Error(&quot;Unable to resolve validator &#x27;&quot; + name + &quot;&#x27;.&quot;);
                                                }
                                                return validator.validate.apply(validator, arguments);
                                            };
                                        }
                                    }
                                }
                                return constraints;
                            }
                        }
                    
                        eval(this.exports);
                    
                    }
                    
                        </pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>